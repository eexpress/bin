#!/bin/bash

#~ å…¼å®¹rootï¼Œéœ€è¦è½¯é“¾æ¥åˆ° /root/.bashrc ä¸‹é¢ã€‚
if [ -f /etc/bashrc ]; then
	. /etc/bashrc	# CommandNotFound æ—¶ï¼Œè‡ªåŠ¨å®‰è£…çš„åŠŸèƒ½ï¼Œåœ¨è¿™æ–‡ä»¶é‡Œã€‚
fi

#~ stty -ixon
set -o vi
export VGL_LOGO=1	# Bumbleebeeæ˜¾ç¤ºå³ä¸‹è§’VGLæ ‡è®°
export GSK_RENDERER=cairo	# Waylandä¸‹, nvidiaé©±åŠ¨ä¸‹ï¼Œgnome-extensionséœ€è¦

#-------ALIAS------------------------------------
[ "$(whoami)" == "root" ] && sudostr="" || sudostr="sudo"
##			-------- è½¯ä»¶åŒ…ç®¡ç† --------
if [ -x /usr/bin/apt ]; then
	alias pi="$sudostr apt install"
	alias pr="$sudostr apt remove"
	alias pu="$sudostr apt update && $sudostr apt upgrade"	# /usr/bin/update-manager
	alias pf='apt list'			# æœç´¢åŒ…å
	alias pfi='apt list --installed'	# æœç´¢å·²å®‰è£…çš„åŒ…ã€‚
	alias pf0='apt search'			# æœç´¢æè¿°ï¼Œå‚æ•°æ˜¯ANDå…³ç³»ã€‚
	alias pinfo='apt show'
	pfile(){ dpkg -S $@ || apt-file search $@; }	# æŸ¥æ‰¾æ–‡ä»¶æ‰€æˆ–å‘½ä»¤å±çš„åŒ…(å·²å®‰è£…/æœªå®‰è£…)
	plist(){ dpkg -L $@ || apt-file list $@; }	# åˆ—å‡ºåŒ…çš„æ–‡ä»¶(å·²å®‰è£…/æœªå®‰è£…)
	#as(){ aptitude search "!~nlib!~ri386!~v $*";}
	alias pwhoneed='apt-cache rdepends'	# æŸ¥çœ‹è°ä¾èµ–è¿™ä¸ªåŒ…
	alias pneed='apt-cache depends'		# æŸ¥çœ‹ä¾èµ–çš„åŒ…
else
	alias pi="$sudostr dnf install"
	alias pr="$sudostr dnf remove"
	alias pu="$sudostr dnf update"
	alias pf="dnf search -C"
	alias pfi="dnf list installed -C"
	##			-------- æœªå®‰è£…çš„åŒ… --------
	# -C å®Œå…¨ä»ç³»ç»Ÿç¼“å­˜è¿è¡Œã€‚é•¿æœŸbug: 1247644ã€‚æ¯æ¬¡éƒ½æç¤ºå¯¼å…¥ GPG å…¬é’¥ã€‚
	#~ pf(){ dnf search -Cy $@|gc $@; }	# æ— å®‰è£…çŠ¶æ€ã€‚æœç´¢å‚æ•°æ˜¯ANDå…³ç³»ã€‚
	#~ pfi(){ dnf list installed "*$1*$2*$3*"|gc $@; }	# æœç´¢å·²å®‰è£…çš„åŒ…ã€‚
	# alias pinfo='dnf info -Cy'			# å¯é€šé…ç¬¦æŸ¥æœªå®‰è£…çš„åŒ…è¯´æ˜
	##			-------- å·²å®‰è£…çš„åŒ… --------
	# åŒ…ä¿¡æ¯ã€‚rpméœ€è¦å·²å®‰è£…çš„ç¡®åˆ‡åŒ…åï¼›dnfå¯é€šé…ç¬¦æŸ¥æœªå®‰è£…çš„åŒ…ã€‚
	pinfo(){ rpm -q --info $1 || dnf info -Cy $1; }
	alias pfile='dnf provides -C'				# æŸ¥æ‰¾æ–‡ä»¶æˆ–å‘½ä»¤æ‰€å±çš„åŒ…(å·²å®‰è£…/æœªå®‰è£…)
	alias pneed='rpm -q --whatrequires'		# è¢«å“ªä¸ªåŒ…éœ€è¦
	# åŒ…çš„æ–‡ä»¶åˆ—è¡¨ã€‚
	plist(){ rpm -q --list $1 || dnf repoquery -Cy --list $1; }

	alias fk="$sudostr flatpak"
	alias fki="$sudostr flatpak install"
	alias fkr="$sudostr flatpak uninstall"
	alias fku="$sudostr flatpak update"
	alias fkf="flatpak search"
	alias fkl="flatpak list --app"
#~ ğŸ”´ flatpak remote-modify flathub --url=https://mirror.sjtu.edu.cn/flathub  //æ›¿æ¢ä¸ºä¸Šæµ·äº¤å¤§æº
fi
##------- ---------
#~ https://clang.llvm.org/docs/ClangFormatStyleOptions.html
alias format='clang-format -style=file -i'
alias glog='journalctl -f -o cat /usr/bin/gnome-shell'
alias jlog='journalctl -f -o cat /usr/bin/gjs'
alias wl='env MUTTER_DEBUG_DUMMY_MODE_SPECS=1600x1000 dbus-run-session -- gnome-shell --nested --wayland'
#~ alias wl='env MUTTER_DEBUG_DUMMY_MODE_SPECS=2560Ã—1440 dbus-run-session -- gnome-shell --nested --wayland'
export LC_ALL=zh_CN.UTF-8
alias cn='export LC_ALL=zh_CN.UTF-8'
alias en='export LC_ALL=C'
alias fc-zh='fc-list :lang=zh-cn family file|sed "s,/.*/,,"|sed "s/:\ \(.*\)/\x1b[0;32m\t\1\x1b[0m/"'
alias dms='/usr/bin/dms -path "`pwd`"'	# : Path must be absolute:

alias tail='/usr/bin/tail -n $(($LINES-4))'
alias head='/usr/bin/head -n $(($LINES-4))'
alias pl='perl -pE'	#-E like -e, BUT enables all features; -p EXCUTE while (<>) THEN print.
alias pln='perl -nE'

ocr(){ tesseract "$1" /tmp/ocr -l chi_sim 2>/dev/null && cat /tmp/ocr.txt; }

alias i='df -hT -x tmpfs -x devtmpfs;echo -e "\nå†…å­˜---------------";free -h|cut -b -50;echo -e "\næ¸©åº¦---------------";sensors|grep Core'
[ -x /usr/bin/gvim ] && alias v='gvim --remote-tab-silent' && alias sv='sudo gvim'
#alias k='pkill -u `id -un` -9 -f'

#edit=("/usr/bin/gedit" "/usr/bin/io.elementary.code" "/usr/bin/geany" "/usr/bin/gnome-text-editor")
#for ed in "${edit[@]}"; do
#	if [ -x $ed ]; then alias e=$ed; break; fi
#done
alias e='/usr/bin/gnome-text-editor'

alias dog='grep -v -E "(^$|^#|^!)"'
alias ps='\ps -u `id -un` -o pid,command'
alias pg='pgrep -af'
alias k='pkill -9 -f'
alias g='grep --color=always -Pi 2>/dev/null'
alias say='~/.local/bin/edge-playback -v zh-CN-XiaoyiNeural -t'

##			-------- LS --------
alias l='\ls --color=always'
alias la='l -A'
alias lt='l -oAh  --time-style=iso -t'		# mtime
alias ls='lt -S'		# size

#-------FUNC------------------------------------
c(){ echo $1|bc -l; }
p(){ ping -c 5 ${1:-www.163.com}; }
u(){ \du -sch "$@" 2>/dev/null|sort -rh; }
# é¼ æ ‡é€‰æ‹©è·¯å¾„æˆ–æ–‡ä»¶ï¼Œå¿«é€Ÿè¿›å…¥ç›®å½•ã€‚
d(){ c=`xclip -o|sed -e "s.^~.$HOME."`; if [ -f "$c" ]; then d=`dirname "$c"`; else d=$c; fi; echo $d; cd "$d";}

export TERM=xterm-256color	# æ”¾åœ¨æ‰€æœ‰tputä¹‹å‰ã€‚
#-------LESS TERMCAP for color manpage------------
#0=black 1=red 2=green 3=yellow 4=blue 5=magenta 6=cyan 7=white
#man terminfo: set_a_foreground -> setaf; set_a_background -> setab;
export LESS_TERMCAP_mb=$(tput bold; tput setaf 1)	# enter_bold_mode
export LESS_TERMCAP_md=$(tput bold; tput setaf 1)	# begin bold
export LESS_TERMCAP_me=$(tput sgr0)					# exit_attribute_mode
export LESS_TERMCAP_so=$(tput bold; tput setaf 3; tput setab 4)
export LESS_TERMCAP_se=$(tput rmso; tput sgr0)		# exit_standout_mode
export LESS_TERMCAP_us=$(tput smul; tput bold; tput setaf 2)	# enter_underline_mode
export LESS_TERMCAP_ue=$(tput rmul; tput sgr0)		# exit_underline_mode
export LESS_TERMCAP_mr=$(tput rev)		# enter_reverse_mode
export LESS_TERMCAP_mh=$(tput dim)		# enter_dim_mode (half-bright)
#export MANPAGER="/usr/bin/less"
export GROFF_NO_SGR=1	#fix manpage no color in Fedora 25/36

#-------ENVIROMENT SET-----------------------------
if [ "$(whoami)" != "root" ]; then
	export PATH=$HOME/bin:$HOME/.local/bin:$PATH
	export CDPATH=:~:~/bin:~/project:~/.local/share/gnome-shell/extensions/:
fi
#-------PS1 COLOR----------------------------------
# ç”¨äºæ„å»ºå½©è‰²ç›®å½•éƒ¨åˆ†çš„å‡½æ•°
colorize_dir_path() {
    #local path=$(echo "$PWD" | perl -pe "s|$HOME|~|")
    local path=$1
    local colored_path="\e[0m"
    local color_array=(27 130 28 133)
    local index=0
    local fgtext='\e[38;5;255m'
    local color=""
    IFS='/' read -ra ADDR <<< $path
    for i in "${ADDR[@]}"; do
        if [ "$i" != "" ]; then
        		color=${color_array[$index]}
        		((index=(index+1)%${#color_array[@]}))
            colored_path+="\e[38;5;${color}mâ—¢\e[48;5;${color}m${fgtext} $i "
            # å‰æ™¯å¾ªç¯è‰²+ â—¢+ èƒŒæ™¯å¾ªç¯è‰²+ å‰æ™¯ç°è‰²+ ä¸€æ®µè·¯å¾„æ–‡å­—
        fi
    done
    # echo -e "${colored_path}${fgray}â—¢\uE0B0\e[0m"	#ç™½è‰²å‰æ™¯
    echo -e "${colored_path}\e[0m\e[38;5;${color}m\uE0B0\e[0m"
    # æ— é¢œè‰²+ å‰æ™¯æœ€åå¾ªç¯è‰²+ ç®­å¤´+ æ— è‰²
}
#--------------------------------------------------
	darkgreen="22"
	darkred="124"
	setbold=`tput bold;`
if [ "$(whoami)" == "root" ]; then
	psch="ğŸ”´"; psc1="\e[48;5;${darkred}m";
else
	psch="â­•"; psc1="\e[48;5;${darkgreen}m";
fi
	pgap="$(tput sgr0) "
	#PS1æ¯æ¬¡æ”¹å˜æ—¶ï¼Œæ‰æŠŠå‡½æ•°å’Œ\wå½“ä½œå­—ç¬¦ä¸²ï¼Œä¼ é€’ç»™PS1çš„æ‰§è¡Œè¿›ç¨‹ï¼Œè®©è¿›ç¨‹æ¯æ¬¡å»è§£æã€‚
	# PS1="$psc1 \D{%A %T} $pgap"'$(colorize_dir_path "\w")'"\n$psch "
	PS1="$psc1 \D{%A %T} $pgap"'$(~/bin/ps1.pl "\w")'
	#PS1="$psc1 \D{%F %A %T} $pgap$(colorize_dir_path "\w")\n$psch "

#-------HISTORY------------------------------------
shopt -s histappend
PROMPT_COMMAND='history -a'

bind 'set completion-ignore-case on'
bind 'set show-all-if-ambiguous on'
bind '"\e[A": history-search-backward'
bind '"\e[B": history-search-forward'

#bash_completion
. /etc/profile.d/bash_completion.sh
#unset command_not_found_handle
#~ cd	# gnome-termianl è°ƒç”¨æ­¤é…ç½®å‰ï¼Œæ‰©å±• note å°±ä¹±è¿›äº†æŸç›®å½•ã€‚

#~ eval "$(starship init bash)"
